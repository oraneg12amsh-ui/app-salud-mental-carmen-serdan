<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego: Clasificaci√≥n Biopsicosocial</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Usamos la fuente Inter, que es moderna y legible */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para los factores arrastrables */
        .factor-item {
            cursor: grab;
            transition: all 0.2s ease;
        }
        .factor-item:active {
            cursor: grabbing;
            opacity: 0.8;
            transform: scale(1.05);
        }
        /* Clase 'dragging' que se a√±ade con JS */
        .dragging {
            opacity: 0.5;
            background: #fff;
            color: #333;
        }
        /* Estilos para las zonas de soltar */
        .drop-zone {
            transition: all 0.2s ease;
            min-height: 100px;
        }
        /* Clase 'drag-over' que se a√±ade con JS */
        .drag-over {
            transform: scale(1.02);
            border-style: dashed;
        }
        
        /* Clases de feedback (correcto/incorrecto) */
        .factor-correct {
            background-color: #22c55e; /* green-500 */
            border-color: #16a34a; /* green-600 */
        }
        .factor-incorrect {
            background-color: #ef4444; /* red-500 */
            border-color: #dc2626; /* red-600 */
        }
    </style>
</head>
<body class="bg-indigo-900 text-white min-h-screen flex items-center justify-center p-4">

    <!-- NUEVO: Pantalla de Inicio -->
    <div id="start-screen" class="w-full max-w-lg mx-auto bg-indigo-800 shadow-2xl rounded-2xl p-6 md:p-10 text-center">
        <h2 class="text-3xl font-bold mb-4">¬°Bienvenido!</h2>
        <p class="text-lg mb-6">Ayuda a Sani a clasificar los factores B-P-S.</p>
        <div class="mb-4">
            <label for="player-name" class="block text-sm font-medium mb-2">Escribe tu nombre:</label>
            <input type="text" id="player-name" class="w-full p-2 rounded bg-indigo-100 text-indigo-900" placeholder="Jugador 1">
        </div>
        <button id="start-button" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg text-xl transition-all duration-300 shadow-lg border-b-4 border-green-800 hover:border-green-700">
            ¬°Comenzar!
        </button>
    </div>

    <!-- Contenedor principal de la app -->
    <!-- MODIFICADO: A√±adido 'hidden' para ocultar al inicio -->
    <div id="app-container" class="w-full max-w-4xl mx-auto bg-indigo-800 shadow-2xl rounded-2xl p-6 md:p-10 hidden">

        <!-- 1. √ÅREA DEL PERSONAJE Y DI√ÅLOGO -->
        <div id="character-area" class="flex flex-col items-center mb-6">
            <!-- El personaje (Sani ü©∫) - SVG -->
            <svg class="w-24 h-24 mb-4" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="25" y="10" width="50" height="50" rx="15" fill="#E0E7FF"/>
                <circle cx="40" cy="35" r="5" fill="#4338CA"/>
                <circle cx="60" cy="35" r="5" fill="#4338CA"/>
                <rect x="40" y="45" width="20" height="3" rx="1.5" fill="#4338CA"/>
                <rect x="30" y="65" width="40" height="25" rx="8" fill="#C7D2FE"/>
                <rect x="35" y="70" width="15" height="15" rx="4" fill="#E0E7FF"/>
                <path d="M40 75H45" stroke="#4338CA" stroke-width="2" stroke-linecap="round"/>
                <path d="M40 80H45" stroke="#4338CA" stroke-width="2" stroke-linecap="round"/>
                <path d="M55 70H65V85H55V70Z" fill="#E0E7FF" stroke="#A5B4FC" stroke-width="2"/>
                <path d="M58 74H62" stroke="#4338CA" stroke-width="2" stroke-linecap="round"/>
                <path d="M58 78H62" stroke="#4338CA" stroke-width="2" stroke-linecap="round"/>
                <path d="M58 82H62" stroke="#4338CA" stroke-width="2" stroke-linecap="round"/>
            </svg>
            
            <!-- Burbuja de di√°logo -->
            <div id="character-speech" class="w-full bg-white text-indigo-900 rounded-lg p-4 text-center font-semibold text-lg min-h-[60px] flex items-center justify-center">
                ¬°Uf! ¬°Tengo todos estos factores desordenados! ¬øMe ayudas a clasificarlos?
            </div>
            
            <!-- NUEVO: Pantalla de Tiempo -->
            <div id="timer-display" class="text-2xl font-bold mt-4 text-green-400">
                Tiempo: 0s
            </div>
        </div>

        <!-- 2. √ÅREA DEL JUEGO -->
        <div id="game-container">
            <!-- Zonas de Soltar (Las 3 esferas) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <!-- Zona Biol√≥gica -->
                <div id="bio-bin" data-category="bio" class="drop-zone bg-green-700 p-4 rounded-lg shadow-inner border-2 border-green-600">
                    <h3 class="text-2xl font-bold text-center mb-4 text-white">Biol√≥gico üß¨</h3>
                    <div class="space-y-2 p-2 bg-black bg-opacity-20 rounded min-h-[100px]">
                        <!-- Los factores ir√°n aqu√≠ -->
                    </div>
                </div>
                <!-- Zona Psicol√≥gica -->
                <div id="psico-bin" data-category="psico" class="drop-zone bg-yellow-700 p-4 rounded-lg shadow-inner border-2 border-yellow-600">
                    <h3 class="text-2xl font-bold text-center mb-4 text-yellow-900">Psicol√≥gico üß†</h3>
                    <div class="space-y-2 p-2 bg-black bg-opacity-20 rounded min-h-[100px]">
                        <!-- Los factores ir√°n aqu√≠ -->
                    </div>
                </div>
                <!-- Zona Social -->
                <div id="social-bin" data-category="social" class="drop-zone bg-blue-700 p-4 rounded-lg shadow-inner border-2 border-blue-600">
                    <h3 class="text-2xl font-bold text-center mb-4 text-white">Social ü§ù</h3>
                    <div class="space-y-2 p-2 bg-black bg-opacity-20 rounded min-h-[100px]">
                        <!-- Los factores ir√°n aqu√≠ -->
                    </div>
                </div>
            </div>

            <hr class="border-indigo-500 my-6">

            <!-- "Piscina" de Factores para Arrastrar -->
            <h4 class="text-xl font-bold text-center mb-4">Factores por Clasificar</h4>
            <div id="factors-pool" class="drop-zone bg-indigo-900 p-4 rounded-lg shadow-inner min-h-[120px] flex flex-wrap gap-3 justify-center items-start">
                <!-- Los factores se generar√°n aqu√≠ con JS -->
            </div>

            <!-- Bot√≥n de Revisi√≥n -->
            <div class="text-center mt-6">
                <button id="check-button" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg text-xl transition-all duration-300 shadow-lg border-b-4 border-green-800 hover:border-green-700">
                    ¬°Revisar Respuestas!
                </button>
                <button id="restart-button" class="bg-gray-500 hover:bg-gray-400 text-white font-bold py-3 px-8 rounded-lg text-xl transition-all duration-300 shadow-lg border-b-4 border-gray-700 hover:border-gray-600 hidden ml-4">
                    Jugar de Nuevo
                </button>
            </div>
        </div>
    </div>

    <script>
    // --- DATOS DEL JUEGO ---
    const factorsData = [
        { id: 'f1', text: 'Gen√©tica', category: 'bio' },
        { id: 'f2', text: 'Estr√©s', category: 'psico' },
        { id: 'f3', text: 'Pobreza', category: 'social' },
        { id: 'f4', text: 'Un virus', category: 'bio' },
        { id: 'f5', text: 'Conducta (fumar)', category: 'psico' },
        { id: 'f6', text: 'Condiciones de trabajo', category: 'social' },
        { id: 'f7', text: 'Acceso a servicios de salud', category: 'social' },
        { id: 'f8', text: 'Una bacteria', category: 'bio' },
        { id: 'f9', text: 'Ansiedad', category: 'psico' },
        { id: 'f10', text: 'Cultura y creencias', category: 'social' },
        { id: 'f11', text: 'Edad y sexo', category: 'bio' },
        { id: 'f12', text: 'Estilo de afrontamiento', category: 'psico' },
        { id: 'f13', text: 'Red de apoyo', category: 'social' },
        { id: 'f14', text: 'Nutrici√≥n', category: 'bio' },
        { id: 'f15', text: 'Ejercicio f√≠sico', category: 'bio' },
        { id: 'f16', text: 'Autoestima', category: 'psico' },
        { id: 'f17', text: 'Vivienda (Hogar)', category: 'social' },
    ];

    // --- REFERENCIAS AL DOM ---
    const factorsPool = document.getElementById('factors-pool');
    const dropZones = document.querySelectorAll('.drop-zone');
    const checkButton = document.getElementById('check-button');
    const restartButton = document.getElementById('restart-button');
    const characterSpeechEl = document.getElementById('character-speech');
    
    // NUEVAS REFERENCIAS
    const startScreen = document.getElementById('start-screen');
    const startButton = document.getElementById('start-button');
    const playerNameInput = document.getElementById('player-name');
    const appContainer = document.getElementById('app-container');
    const timerDisplay = document.getElementById('timer-display');

    let draggedItem = null; // Variable para guardar el item que se est√° arrastrando

    // NUEVAS VARIABLES DE ESTADO
    let playerName = "Jugador";
    let startTime = null;
    let timerInterval = null;

    // --- FUNCIONES DEL JUEGO ---

    /**
     * Inicia el juego: oculta inicio, muestra app, empieza el timer
     */
    function startGame() {
        playerName = playerNameInput.value.trim() || "Jugador 1"; // Obtiene el nombre
        
        startScreen.classList.add('hidden'); // Oculta inicio
        appContainer.classList.remove('hidden'); // Muestra juego

        // Limpia el timer anterior si existe
        if (timerInterval) {
            clearInterval(timerInterval);
        }

        initializeGame(); // Prepara el tablero

        // Inicia el temporizador
        startTime = new Date();
        timerInterval = setInterval(updateTimer, 1000);
        updateTimer(); // Llama una vez para poner 0s
        
        // Mensaje de bienvenida
        characterSpeechEl.textContent = `¬°Hola ${playerName}! ¬°Ay√∫dame a clasificar estos factores!`;
    }

    /**
     * Actualiza el cron√≥metro en pantalla
     */
    function updateTimer() {
        if (!startTime) return; // No actualices si el juego no ha empezado
        const now = new Date();
        const elapsedTime = Math.floor((now - startTime) / 1000); // en segundos
        timerDisplay.textContent = `Tiempo: ${elapsedTime}s`;
    }

    /**
     * Llena la piscina de factores al inicio
     */
    function initializeGame() {
        // Limpia la piscina y las zonas
        factorsPool.innerHTML = '';
        dropZones.forEach(zone => {
            if (zone.id !== 'factors-pool') {
                zone.querySelector('div').innerHTML = '';
            }
        });

        // Resetea botones y feedback
        checkButton.classList.remove('hidden');
        restartButton.classList.add('hidden');
        // Se quita el reseteo de 'characterSpeechEl' de aqu√≠

        // Baraja los factores (opcional pero recomendado)
        const shuffledFactors = [...factorsData].sort(() => Math.random() - 0.5);

        // Crea los elementos de factor
        shuffledFactors.forEach(factor => {
            const factorEl = document.createElement('div');
            factorEl.id = factor.id;
            factorEl.dataset.category = factor.category;
            factorEl.textContent = factor.text;
            factorEl.draggable = true;
            factorEl.classList.add('factor-item', 'bg-indigo-600', 'text-white', 'font-semibold', 'py-2', 'px-4', 'rounded-lg', 'shadow');
            
            // A√±ade listeners de drag
            factorEl.addEventListener('dragstart', handleDragStart);
            factorEl.addEventListener('dragend', handleDragEnd);
            
            factorsPool.appendChild(factorEl);
        });

        // Remueve el feedback de partidas anteriores
        document.querySelectorAll('.factor-correct, .factor-incorrect').forEach(el => {
            el.classList.remove('factor-correct', 'factor-incorrect');
            el.classList.add('bg-indigo-600');
        });
    }

    // --- MANEJADORES DE DRAG & DROP ---

    function handleDragStart(e) {
        draggedItem = e.target; // Guarda el elemento que se est√° arrastrando
        e.dataTransfer.setData('text/plain', e.target.id);
        setTimeout(() => {
            e.target.classList.add('dragging'); // Oculta el original con un delay
        }, 0);
    }

    function handleDragEnd(e) {
        e.target.classList.remove('dragging'); // Vuelve a mostrarlo
        draggedItem = null;
    }

    function handleDragOver(e) {
        e.preventDefault(); // ¬°Esencial para permitir el drop!
        const dropZone = e.target.closest('.drop-zone');
        if (dropZone) {
            dropZone.classList.add('drag-over');
        }
    }

    function handleDragLeave(e) {
        const dropZone = e.target.closest('.drop-zone');
        if (dropZone) {
            dropZone.classList.remove('drag-over');
        }
    }

    function handleDrop(e) {
        e.preventDefault();
        const dropZone = e.target.closest('.drop-zone');
        if (dropZone && draggedItem) {
            // Si la zona es la piscina principal, la a√±ade. Si es una caja de categor√≠a, la a√±ade al 'div' interno.
            const targetContainer = (dropZone.id === 'factors-pool') ? dropZone : dropZone.querySelector('div');
            targetContainer.appendChild(draggedItem);
            dropZone.classList.remove('drag-over');
        }
    }

    // --- L√ìGICA DE REVISI√ìN ---

    function checkAnswers() {
        // --- NUEVO: Detener el timer ---
        clearInterval(timerInterval);
        const endTime = new Date();
        const totalTime = Math.floor((endTime - startTime) / 1000); // en segundos

        let correctCount = 0;
        let totalClassified = 0;
        
        checkButton.classList.add('hidden');
        restartButton.classList.remove('hidden');

        dropZones.forEach(zone => {
            // Solo revisa las 3 zonas de categor√≠as, no la piscina
            if (zone.id !== 'factors-pool') {
                const zoneCategory = zone.dataset.category;
                const factorsInZone = zone.querySelectorAll('.factor-item');

                factorsInZone.forEach(factor => {
                    totalClassified++;
                    const factorCategory = factor.dataset.category;
                    
                    // Quita el color base
                    factor.classList.remove('bg-indigo-600');

                    if (factorCategory === zoneCategory) {
                        factor.classList.add('factor-correct');
                        correctCount++;
                    } else {
                        factor.classList.add('factor-incorrect');
                    }
                    
                    // No se pueden mover despu√©s de revisar
                    factor.draggable = false;
                    factor.style.cursor = 'default';
                });
            }
        });

        // Feedback de Sani (MODIFICADO)
        if (totalClassified === 0) {
            characterSpeechEl.textContent = `¬°Oh ${playerName}! No clasificaste ning√∫n factor. ¬°Int√©ntalo de nuevo!`;
        } else if (correctCount === totalClassified && totalClassified === factorsData.length) {
            characterSpeechEl.textContent = `¬°Perfecto, ${playerName}! Clasificaste ${correctCount}/${totalClassified} en ${totalTime}s. ¬°Eres un experto!`;
        } else {
            characterSpeechEl.textContent = `¬°Buen trabajo, ${playerName}! Clasificaste ${correctCount}/${totalClassified} en ${totalTime}s.`;
        }
        
        // Deshabilita los factores restantes en la piscina
        factorsPool.querySelectorAll('.factor-item').forEach(factor => {
             factor.draggable = false;
             factor.style.cursor = 'default';
             factor.classList.add('opacity-50');
        });
    }

    // --- INICIALIZACI√ìN ---
    
    // A√±ade listeners a las zonas de soltar
    dropZones.forEach(zone => {
        zone.addEventListener('dragover', handleDragOver);
        zone.addEventListener('dragleave', handleDragLeave);
        zone.addEventListener('drop', handleDrop);
    });

    // Listeners de los botones
    startButton.addEventListener('click', startGame); // <-- NUEVO
    checkButton.addEventListener('click', checkAnswers);
    // MODIFICADO: Reiniciar te lleva a la pantalla de inicio
    restartButton.addEventListener('click', () => {
        appContainer.classList.add('hidden');
        startScreen.classList.remove('hidden');
        timerDisplay.textContent = "Tiempo: 0s";
        playerNameInput.value = ""; // Limpia el nombre
    });

    // Inicia el juego
    // document.addEventListener('DOMContentLoaded', initializeGame); // Ya no se usa
    </script>
</body>
</html>
